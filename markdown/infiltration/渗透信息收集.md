# 渗透信息收集

**渗透信息收集是针对网站的信息收集**

**在渗透测试中，信息收集是必不可少的**

**对站点进行渗透中收集到了足够多的信息，可以方便和帮助与我们进行漏洞的查找**



## 渗透信息收集其一： 域名信息收集whois

**域名是一串用点分隔的名字组成的，在互联网上某一台计算机或计算机组的名称，用于数据传输时的定位与标识**

**例如：`www.baidu.com`** **www是三级域名后面的`baidu`为二级域名,后面的是顶级域名**

**计算机浏览网站的过程就是从DNS服务器获取域名信息对应的IP信息，再通过获取到的信息访问网站**

----

#### whois

* **whois和域名的介绍**

  **whois是用来查询域名的IP以及所有者的信息的传输协议**

  **通常用于查询域名是否已经被注册，以及注册人的信息**

  **不同的域名子域名信息需要到不同的whois数据库**

  > 1. 顶级域名
  >    * 顶级域名分两种
  >      1. 国家顶级域名，例如: .cn(中国)、.us(美国)、.jp(日本
  >      2. 国际顶级域名，例如: .firm(公司企业)、.store(销售企业)、.web(突出网站活动的组织)、.name(个人)、.ac(科研机构)、.edu(教育机构)、.gov(政府机构)、.com(企业机构)、.org(公益或非盈利机构)
  > 2. 二级域名
  >    * 顶级域名之下的域名
  > 3. 三级域名
  >    * 可以使用(A-Z、a-z、0-9和`_`)之间搭配组成，长度不能超过20个字符

  **`.com`的whois数据库就是VeriSign运营商管理**

  **`.cn`由CNNIC(中国互联网信息中心)管理**

* **whois基本原理**

  > 客户端向服务器的TCP端口43进行连接，发送查询关键字
  >
  > 服务端之后就会返回查询结果给客户端

* **whois查询的重要性**

  **通过whois的查询可以获得域名注册者的信息，例如: Email(邮箱)、phone number(电话号)、fax number(传真号)等信息**

  **方便之后进行的信息探测，也还可以通过这些东西进行暴力破解的字典进行生成**

* **whois查询方法**

  * **在线查询:**

    > `https://whois.aliyun.com`
    >
    > `https://www.whois365.com/cn/`
    >
    > `https://whois.chinaz.com/`
    >
    > `https://whois.aizhan.com/`

  * **whois命令行工具**

    > kali linux自带whois工具
    >
    > depain系可用apt软件管理包进行下载
    >
    > redhat系可用yum软件管理包进行下载
    >
    > arch系可用pacman和aur进行下载
    >
    > opensuse系可用zyyper和YaST进行下载



##  渗透信息手机其二: 子域名查询		

**子域名，只要是在顶级域名前面的都称为子域名**

---

#### 子域名查询

* **子域名查询的作用**

  * **如果在主域找不到漏洞，可以通过主域下的子域去查找漏洞去接近主域**

* **子域名挖掘**

  * **子域名挖掘工具**

    > Maltego CE
    >
    > wydomain
    >
    > subDomainsBrute
    >
    > dnsmaper 
    >
    > Layer
    >
    > theHarvester
    >
    > amass
    >
    > oneforall等

  * **使用搜索引擎查询**

    > 搜索引擎可以使用site命令
    >
    > site命令使用来查询关键字的，语法site: 后面跟要加入的关键字

  * **使用第三方网站查询**

    > `https://tool.chinaz.com/subdomain`
    >
    > `https://dnsdumpster.com/`

  * **证书网站公开的信息**

    > `https://crt.sh/`
    >
    > `https://censys.io/`

  * **使用第三方在线工具爆破**

    > `https://phpinfo.me/domain`
    >
    > `http://dns.aizhan.com`



## 渗透信息收集其三: web站点信息收集

**CMS指纹识别CMS(内容管理系统)，又称整站系统或者文章系统，用于网站内容管理。各种cms都有其独特的结构命名规则和特定的文件内容，因此可以利用这些内容来获取cms站点的具体软件cms与版本，因为其特征与指纹一样独一无二，所以称其为指纹识别**

**常见的cms：dedecms(织梦)、DIscuz、phpcms等**

---

#### cms识别工具

* **在线工具**

  > `https://whatweb.bugscaner.com/look/`
  >
  > `http://www.yunsee.cn/finger.html`

* **本地工具**

  > 御剑web指纹识别程序
  >
  > 大禹cms识别程序
  >
  > dirb
  >
  > dirbuster



## 渗透信息收集其四: 端口信息收集

**如果把计算机当作一个酒店，端口就是酒店的门派号，每个计算机端口都有2^16个即65536个**

**端口号只有正整数范围是0~65536(2^16-1)**

**计算机的服务基本上都有自己的默认端口号**

> 例如: http:80 telnet:23 ftp:21 ssh:22 mysql:3306 远程桌面:3389等

---

#### 端口查看

* **本地端口查看工具**

  > netstat使用方法
  >
  > NETSTAT [-a] [-b] [-e] [-f] [-n] [-o] [-p proto] [-r] [-s] [-t] [-x] [-y] [interval]
  >
  >   -a            显示所有连接和侦听端口。
  >   -b            显示在创建每个连接或侦听端口时涉及的
  >                 可执行文件。在某些情况下，已知可执行文件托管
  >                 多个独立的组件，此时会
  >                 显示创建连接或侦听端口时
  >                 涉及的组件序列。在此情况下，可执行文件的
  >                 名称位于底部 [] 中，它调用的组件位于顶部，
  >                 直至达到 TCP/IP。注意，此选项
  >                 可能很耗时，并且可能因为你没有足够的
  >                 权限而失败。
  >   -e            显示以太网统计信息。此选项可以与 -s 选项
  >                 结合使用。
  >   -f            显示外部地址的完全限定
  >                 域名(FQDN)。
  >   -n            以数字形式显示地址和端口号。
  >   -o            显示拥有的与每个连接关联的进程 ID。
  >   -p proto      显示 proto 指定的协议的连接；proto
  >                 可以是下列任何一个: TCP、UDP、TCPv6 或 UDPv6。如果与 -s
  >                 选项一起用来显示每个协议的统计信息，proto 可以是下列任何一个:
  >                 IP、IPv6、ICMP、ICMPv6、TCP、TCPv6、UDP 或 UDPv6。
  >   -q            显示所有连接、侦听端口和绑定的
  >                 非侦听 TCP 端口。绑定的非侦听端口
  >                 不一定与活动连接相关联。
  >   -r            显示路由表。
  >   -s            显示每个协议的统计信息。默认情况下，
  >                 显示 IP、IPv6、ICMP、ICMPv6、TCP、TCPv6、UDP 和 UDPv6 的统计信息；
  >                 -p 选项可用于指定默认的子网。
  >   -t            显示当前连接卸载状态。
  >   -x            显示 NetworkDirect 连接、侦听器和共享
  >                 终结点。
  >   -y            显示所有连接的 TCP 连接模板。
  >                 无法与其他选项结合使用。
  >   interval      重新显示选定的统计信息，各个显示间暂停的
  >                 间隔秒数。按 CTRL+C 停止重新显示
  >                 统计信息。如果省略，则 netstat 将打印当前的
  >                 配置信息一次。

* **查看目标端口工具**

  > namp使用方法
  >
  > nmap指令:
  >
  > * -A  表示使用侵略性的策略进行探测
  > * -iL 从文件中进行主机发现
  > * -sL 仅列出网段上所有主机，不发送任何报文
  > * -Pn/-P0 无ping扫描
  > * -PS TCP SYN Ping扫描
  > * -PA TCP ACK Ping扫描
  > * -n 禁止反向DNS解析
  > * -v  表示持续输出探测结果
  > * -T  表示探测的速度，速度等级是1~5，例如T4   
  > * -sC 是表示使用nmap脚本，一般为默认脚本
  > * -sV 是表示探测目标机器上的服务信息
  > * -sP 是表示对目标主机进行ping扫描
  > * -sT 是tcp探测
  > * -sW windows扫描
  > * -sM maimon扫描
  > * -sU UDP扫描
  > * -sF  tcp空测试扫描
  > * -sX FIN和Xmas扫描
  > * --sanflags 自定义tcp扫描
  > * -sI 空闲扫描
  > * -sO IP协议扫描
  > * -sn 仅发现主机，不进行端口扫描
  > * -b FTP退会扫描端口规格和扫描
  > * -O 时表示目标机器的操作系统信息
  > * -oX （文件名） 将结果输出为文件
  > * -p 指定端口，例如-p 80；也可以同时扫描多个端口80,3306;也可以进行范围扫描1-65536
  > * F 快速扫描模式
  > * -r 连续扫描端口，不随机
  > * --top-ports <编号> 扫描\<number>最常用的端口
  > * --port-ratio 扫描笔\<ratio>更常见的端口服务或版本检测
  > * --traceroute 路由跟踪
  > * --dns-servers 指定dns服务器扫描
  > * --exclude 不扫描包含指定的主机
  > * -PB 是进行CMP请求
  >
  > 
  >
  > nmap状态:
  >
  > * open 端口打开
  > * closed 端口关闭
  > * filtered 端口被防火墙IDS/IPS屏蔽，无法确认状态
  > * unfiltered 端口没有被屏蔽，但是否开放需要进一步确定
  > * open | filtered 端口开放的或者被屏蔽
  > * closed | filtered 端口是关闭的或者被屏蔽



## 渗透信息其五：敏感信息泄露

**针对一些安全做得很好得目标，通过技术层面无法突破完成渗透，在这种情况下，可以利用搜索引擎搜索目标暴露在互联网上的关联信息。例如: 数据库文件，sql注入，服务器配置信息，cms站点版本，github上的网站源码、redis的未授权访问，robots协议等敏感信息从而达到渗透的目的**

---

#### 敏感信息收集

* **搜索引擎的使用语法**

  > 每个浏览器都有自己的语法，使其能更好的让使用者搜索到自己想要的信息
  >
  > google为例子
  >
  > site 指定搜索域名 例如：site: baidu.com
  >
  > inurl: 指定搜索url中是否存在的关键字 例如: inurl: id=
  >
  > filetype: 指定搜索文件类型 例如: robots.txt
  >
  > intitle: 指定搜索网页标题中是否存在的关键字 例如: intitle:后台管理
  >
  > link： 指定搜索设置了指定的关键字作为外链的网站 link: baidu.com
  >
  > info:  指定搜索页面包含的信息 例如：info: baidu.com
  >
  > intext: 执行标题
  >
  > 有一个集成payload网站，可以去参照着查询
  >
  > `https://www.exploit-db.com/google-hackin-database/`

* **http响应头部信息**

  > 通过HTTP或HTTPS返回的响应头信息中的server头或X-Powered-By头等头部信息中可能暴露出目标服务器和使用的编程语言信息，可以通过这些来进行漏洞的尝试
  >
  > 工具可以使用Burpsuite
  >
  > 也可以使用python写脚本来查看

* **Github信息泄露**

  > GitHub是世界上最大的代码托管平台，超5千万开发者正在使用。人数众多，托管的项目也非常多，所以一些web开源项目的源码是可以在github上找到的，可以通过github来找到源码然后进行代码审计查看代码的漏洞进行渗透
  >
  > 配合搜索引擎的搜索语法可以查看相关的源码	
  >
  > 例如:
  >
  > site: github.com info: mysqli

  

  

  

  

  ​	

  